@model PayrollBO.AssignManager



<h2 id="pgeTitle">Leave Entry</h2>
<div id="EntryScreen" class="form-horizontal">
    <label id="lblhiddenNavtab" class="control-label nodisp"></label>

    <div class="col-sm-12">
        <div class="col-sm-6">
            <div class="form-group">
                <label class="control-label col-md-4">
                    Employee Code <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-7">
                    <select class="form-control" id="sltEmpCode" onchange=""></select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4">
                    Date of Joining <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-7 ">
                    <input type="text" id="txtDateJoin" class="form-control datepicker" placeholder="Date of Joining"
                           readonly />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4">
                    1st Level Contact <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-7 nodisp">
                    <input type="text" id="txt1stLevel" class="form-control" readonly disabled="disabled" />
                </div>
                <div class="col-md-7">
                    <input type="text" id="txt1stlvlData" class="form-control" readonly disabled="disabled" />
                </div>
                <!-- <div class="col-md-7">
                     <input type="text" id="txt1stLevel" class="form-control" readonly disabled="disabled" />
                 </div>-->
            </div>
            <div class="form-group">
                <label class="control-label col-md-4">
                    From <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-4">
                    <input type="text" id="txtFromDate" class="datepicker form-control Reqrd" placeholder="From Date" size="10" />
                </div>

                <div class="col-md-3" size="10">
                    <select class="form-control" id="FsltDay">
                        <option value="0">Full</option>
                        <option value="1">1st</option>
                        <option value="2">2nd</option>
                    </select>
                </div>

            </div>
            <div class="form-group">
                <label class="control-label col-md-4">
                    Reason <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-7">
                    <input type="text" id="txtReason" class="form-control Reqrd" placeholder="Enter the Reason"
                           required />
                </div>
            </div>

        </div>
        <div class="col-sm-6">
            <div class="form-group">
                <label class="control-label col-md-4">
                    Employee Name <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-7">
                    <input type="text" id="txtEmpName" class="form-control" readonly placeholder="Employee Name" />
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4">
                    Date<label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-7">
                    <input type="text" id="txtDate" class="form-control " placeholder=""
                           readonly />
                </div>
            </div>


            <div class="form-group">
                <label class="control-label col-md-4">
                    Leave Type <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-5">
                    <select id="sltLevType" class="form-control Reqrd" Reqrd></select>
                </div>

                <span class="badgeLbal" id="lblBalance" style="background-color:#01978e;color:#ffffff"></span>
                <label class="nodisp" id="lblBalanceLevHide"></label>
                @*<div id="idlblbalance">

                    </div>*@

            </div>


            <div class="form-group">
                <label class="control-label col-md-4">
                    To <label style="color:red;font-size: 13px">*</label>
                </label>
                <div class="col-md-4">
                    <input type="text" id="txtToDate" class="datepicker form-control Reqrd" placeholder="To Date" size="10"
                           Reqrd />
                </div>
                <div class="col-md-3" size="10">
                    <select class="form-control" id="TsltDay">
                        <option value="0">Full</option>
                        <option value="1">1st</option>
                        <option value="2">2nd</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label class="control-label col-md-4">Contact No</label>
                <div class="col-md-7"><input type="text" id="txtContact" multiple class="form-control Reqrd" placeholder="Enter the Contact Number" maxlength="12" onkeypress="return $validator.IsPhone(event, this.id)" /></div>
            </div>

            <div class="form-group nodisp" id="divattachment">
                <label id="attachtempID" class="control-label col-md-4 nodisp"></label>
                <label id="fullpathID" class="control-label col-md-4 nodisp"></label>
                <label class="control-label col-md-4">Proof Attachment</label>
                <div class="col-md-7 nodisp"><input type="file" id="idattach" name="pic" class="btn custom-button" accept="image/*" onchange="readURL(event);"></div>
                <div class="col-md-3">
                    <input type="button" id="btnattach" accept="image/x-png,application/pdf,image/jpeg" class="btn custom-button" onclick="triggerchoosefile()" value="Choose File">
                </div>
                <div class="col-md-3">
                    <label id="lblattachfrmt" style="cursor:pointer" value="Add" data-toggle="modal" data-target="#Showattachment" onclick="AddInitialize($('#fullpathID').text(),$('#lblattachfrmt').text())"></label>
                </div>
            </div>
            @*<div class="form-group nodisp" id="divattachment" action="myform.cgi">
                    <label class="control-label col-md-4">
                        Proof Attachment
                    </label>
                    <div class="col-md-5 nodisp">
                        <input type="file" name="fileupload" accept="image/x-png,image/gif,image/jpeg" value="fileupload" id="fileupload" onchange="readURL(event);">
                    </div>
                    <div class="col-md-2">
                        <input type="button" id="btnEmpImgUpl" accept="image/x-png,image/gif,image/jpeg" class="btn custom-button" onclick="triggerEmpImg()" value="Upload">
                    </div>
                    <div class="col-md-3">
                        <label id="lblEmpImgName" for="myEmpImgName" style="cursor:pointer">
                            Upload Attachment
                        </label>
                    </div>
                    <div class="col-md-1">
                        <img id="EMPimg" src="~/assets/images/profile.png" alt="user-image" style="width:60px;height:60px" class="img-circle img-inline">
                    </div>
                </div>*@


            @*<div class="form-group">
                    <label class="control-label col-md-4">
                        Leaving Station <label style="color:red;font-size: 13px">*</label>
                    </label>
                    <div class="col-md-7">
                        <select class="form-control" id="sltLeavingStation">
                            <option value="0">No</option>
                            <option value="1">Yes</option>
                        </select>
                    </div>
                </div>*@
            @*<div class="form-group">
                    <label class="control-label col-md-4">
                        Full/Half Day <label style="color:red;font-size: 13px">*</label>
                    </label>
                    <div class="col-md-7">
                        <select class="form-control" id="sltDay">
                            <option value="0">Full Day</option>
                            <option value="1">Half Day</option>
                        </select>
                    </div>
                </div>*@
        </div>
        <div id="Showattachment" class="modal fade" role="dialog" aria-hidden="true" data-backdrop="static"
             data-keyboard="false">
            @Html.Partial("~/Views/Leave/ShowAttachment.cshtml")
        </div>
        <div class="col-sm-12">
            <div class="form-group col-md-3">

            </div>

            <div id="divCancelReason"></div>
            <input type="hidden" value=@ViewBag.EnteredBy id="lblEnteredBy" />
            <div class="form-group">
                <input id="hdnEmpId"
                       name="hiddenId"
                       type="hidden"
                       value="@Session["EmployeeId"]" />

            </div>
        </div>

   @Html.Partial("~/Views/Leave/_CompOffGainBalModel.cshtml")
    </div>
    <div class="form-group col-md-6">
        <div class="col-md-2">
            <input type="button" id="btnaddleaverequest" value="Add" class="btn custom-button pull-right nodisp " />
        </div>
        <div class="col-md-2">
            <input type="button" id="btnsaveleaverequest" value="Confirm" class="btn custom-button pull-right " />
        </div>
        <div class="col-md-2">
            <input type="button" value="Clear" onclick="$leave.clearData()" class="btn custom-button pull-right " />
        </div>

    </div>

    <div class="col-sm-12">

        <table id="tblLeaveList">
            <thead>
                <tr>
                    <th class="nodisp"></th>
                    <th>From Date</th>
                    <th>From Day</th>
                    <th>To Date</th>
                    <th>To Day</th>
                    <th>No Of Days</th>
                    <th>LeaveType</th>
                    <th>Reason</th>
                    <th>Status</th>
                    @*<th>Action</th>*@
                    <th></th>


                </tr>
            </thead>
            <tbody>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    @*<td></td>*@
                    <td></td>



                </tr>
            </tbody>

        </table>


    </div>

</div>

<script src="~/Js/Company/CompanyCom.js" type="text/javascript"></script>
<script src="~/Js/Leave/leaveRequest.js"></script>
<script type="text/javascript">
    debugger;
    $('#lblhiddenNavtab').text("leaveReq");
    var dateString = new Date();
    $("#txtDate").val(dateString.getDate() + '/' + $payroll.GetMonthName((dateString.getMonth() + 1)) + '/' + dateString.getFullYear());
    $payroll.initDatetime();
    $companyCom.loadLeaveTypeforleaverequest({ id: 'sltLevType' });
    $leave.getManager({ Email: 'txt1stLevel' });

    $companyCom.loadEmployee({ id: 'sltEmpCode' });
    debugger;
    $("#sltEmpCode").val($("#hdnEmpId").val()).prop('disabled', true);
    //var data = {("#hdnEmpId").val()};
    $leave.GetEmployeDetail($("#hdnEmpId").val());
    $leave.LoadData("leaveReq");
    $leave.designForm('divCancelReason');
    function triggerchoosefile() {

        $("#idattach").click();

    }

    function AddInitialize(path, file) {
        debugger;
        var formData = document.forms["frmAttachmentPreview"];
        var array = file.split(".");
        if (array[1].toLowerCase() == "pdf") {
            $('#divimgid').addClass("nodisp");
            $('#divpdfid').removeClass("nodisp");
            $('#preView').prop('src', path);
            $('#preViewSrc').prop('src', path);
        }
        else {
            $('#divimgid').removeClass("nodisp");
            $('#divpdfid').addClass("nodisp");
            $('#idimgfile').prop('src', ('..' + path));
        }


    }


    function readURL(input) {
        debugger;
        var files = input.target.files;
        if (files.length > 0) {
            var ext = files[0].name.split('.').pop().toLowerCase();
            if ($.inArray(ext, ['pdf', 'png', 'jpg', 'jpeg']) == -1) {
                $app.showAlert('invalid Image Format!', 4);
                return false;
            }
            var file = files[0];
            fileName = file.name;
            size = file.size;
            type = file.type;
            if (window.FormData !== undefined) {
                var data = new FormData();
                for (var x = 0; x < files.length; x++) {
                    data.append(files[x].name, files[x]);
                }
                console.log(data);
                $.ajax({
                    url: $app.baseUrl + "LeaveRequest/UploadFile",
                    data: data,
                    dataType: "json",
                    type: "POST",
                    contentType: false,
                    cache: false,
                    processData: false,

                    success: function (jsonResult) {
                        debugger;
                        console.log(jsonResult);
                        $app.clearSession(jsonResult);

                        switch (jsonResult.Status) {
                            case true:
                                debugger;
                                var out = jsonResult.result;
                                var array = out.split(",");
                                $('#attachtempID').text(array[0]);
                                $('#lblattachfrmt').text(array[1]);
                                $('#fullpathID').text(array[2]);
                                break;
                            case false:
                                $app.hideProgressModel();
                                $app.showAlert(jsonResult.message[0], "warning");
                                break;
                        }

                    }
                });
            }
            else {
                $app.showAlert("This browser doesn't support HTML5 file uploads!", 3);
                return false;
            }
        }
    }
</script>




